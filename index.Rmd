---
title: " "
output:
  html_document:
    toc_float: false
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, error = FALSE )
root <- rprojroot::find_rstudio_root_file()
dataDir <- file.path(root, 'data')
shapeDir <- file.path(root, 'shape')
library(googlesheets4)
library(dplyr)
library(sf)
library(stringr)
library(lubridate)
library(leaflet)
library(shiny)
```

```{r}
h2(style = "text-align: center;", "APN Sustainable Cities Research")
div(style = "text-align: center;", "Here is some text about the project and introduction.")
```


```{r}
mainDF <- read_sheet("https://docs.google.com/spreadsheets/d/1kcZ6gZW1_okGLb1QscCwcjCAi4W3osO18D-uceZcJME/edit?usp=sharing",sheet = 1)
```


```{r, fig.align='center'}
mainMapDF <- mainDF %>% 
    filter(Role == "Researcher") %>% 
    group_by(City, Country) %>% 
    summarize(Lat = first(Lat),
              Lon = first(Lon)) %>% 
    st_as_sf(coords = c("Lon", "Lat"), crs = 4326)

popup <- paste0( "Country: "
                 , mainMapDF$Country 
                 , "<br>"
                 , "City: "
                 , mainMapDF$City
                 , "<br>",
                 "<b><a href='",
                 paste0(stringr::str_to_lower(mainMapDF$City),".html"),
                 "'>Research Page</a></b>"
               )
leaflet(mainMapDF) %>% 
     addProviderTiles(providers$Esri.WorldImagery) %>% 
    addMarkers(popup = ~popup)
```

